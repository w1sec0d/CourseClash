"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[824],{5024:(e,r,n)=>{n.d(r,{O5:()=>u,c4:()=>c,clearAuthTokens:()=>g,fE:()=>d});let t={path:"/",maxAge:2592e3,secure:!0,sameSite:"strict"},o=(e,r,n)=>{let o={...t,...n},a="".concat(e,"=").concat(encodeURIComponent(r));a+="; path=".concat(o.path),a+="; max-age=".concat(o.maxAge),a+="; samesite=".concat(o.sameSite),o.secure&&(a+="; secure"),document.cookie=a},a=e=>{for(let r of document.cookie.split(";")){let[n,t]=r.trim().split("=");if(n===e)return decodeURIComponent(t)}return null},s=e=>{document.cookie="".concat(e,"=; path=/; expires=Thu, 01 Jan 1970 00:00:00 GMT; secure; samesite=strict")},i="auth_token",l="refresh_token",u=e=>{o(i,e)},c=()=>a(i),d=e=>{o(l,e,{maxAge:2592e3})},g=()=>{s(i),s(l)}},5388:(e,r,n)=>{n.d(r,{l:()=>t});class t extends Error{constructor(e,r="UNKNOWN_ERROR",n){super(e),this.code=r,this.name="AuthError",Object.setPrototypeOf(this,t.prototype),this.isServerError=null!=n&&n}}},6824:(e,r,n)=>{n.d(r,{AuthProviderApollo:()=>v,$:()=>A});var t=n(5933),o=n(5155),a=n(2115),s=n(5388),i=n(6112),l=n(4998),u=n(1929),c=n(5024);function d(){let e=(0,t._)(["\n  mutation Login($email: String!, $password: String!) {\n    login(email: $email, password: $password) {\n      __typename\n      ... on AuthSuccess {\n        user {\n          id\n          username\n          email\n          fullName\n          avatar\n          role\n          createdAt\n          updatedAt\n        }\n        token\n        refreshToken\n        expiresAt\n      }\n      ... on AuthError {\n        message\n        code\n      }\n    }\n  }\n"]);return d=function(){return e},e}function g(){let e=(0,t._)(["\n  query Me {\n    me {\n      id\n      username\n      email\n      fullName\n      avatar\n      role\n      createdAt\n      updatedAt\n    }\n  }\n"]);return g=function(){return e},e}function m(){let e=(0,t._)(["\n  mutation Logout {\n    logout\n  }\n"]);return m=function(){return e},e}let f=(0,i.J1)(d()),w=(0,i.J1)(g()),E=(0,i.J1)(m());function h(){let e=(0,t._)(["\n  mutation Register(\n    $username: String!\n    $email: String!\n    $password: String!\n    $fullName: String\n    $role: UserRole\n  ) {\n    register(\n      username: $username\n      email: $email\n      password: $password\n      fullName: $fullName\n      role: $role\n    ) {\n      __typename\n      ... on AuthSuccess {\n        user {\n          id\n          username\n          email\n          fullName\n          avatar\n          role\n          createdAt\n          updatedAt\n        }\n        token\n        refreshToken\n        expiresAt\n      }\n      ... on AuthError {\n        message\n        code\n      }\n    }\n  }\n"]);return h=function(){return e},e}function p(){let e=(0,t._)(["\n  mutation ForgotPassword($email: String!) {\n    forgotPassword(email: $email) {\n      __typename\n      ... on ForgotPasswordSuccess {\n        message\n        code\n        token\n      }\n      ... on ForgotPasswordError {\n        message\n        code\n      }\n    }\n  }\n"]);return p=function(){return e},e}function R(){let e=(0,t._)(["\n  mutation UpdatePassword(\n    $newPassword: String!\n    $code: String!\n    $email: String!\n  ) {\n    updatePassword(newPassword: $newPassword, code: $code, email: $email) {\n      __typename\n      ... on UpdatePasswordSuccess {\n        message\n      }\n      ... on UpdatePasswordError {\n        message\n        code\n      }\n    }\n  }\n"]);return R=function(){return e},e}let _=(0,i.J1)(h()),k=(0,i.J1)(p()),y=(0,i.J1)(R()),S=(0,a.createContext)(void 0);function v(e){let{children:r}=e,[n,t]=(0,a.useState)(!1),[i,d]=(0,a.useState)(!1),{login:g,loading:m}=function(){let[e,{loading:r,error:n}]=(0,l.n)(f),[t,o]=(0,a.useState)(null);return{login:async(r,n)=>{o(null);try{let{data:t}=await e({variables:{email:r,password:n}});if("AuthError"===t.login.__typename){console.log("\uD83D\uDD10 Authentication error:",t.login.code,t.login.message);let e=new s.l(t.login.message||"Error de autenticaci\xf3n",t.login.code,!1);return o(e.message),{error:e}}return console.log("âœ… Login successful"),(0,c.O5)(t.login.token),t.login.refreshToken&&(0,c.fE)(t.login.refreshToken),{data:t.login}}catch(t){console.error("\uD83D\uDEA8 Server/Network error:",t);let e="SERVER_ERROR",r="Error del servidor. Intenta de nuevo m\xe1s tarde.";if(t&&"object"==typeof t&&"networkError"in t){let n=t.networkError;if(null==n?void 0:n.statusCode)switch(n.statusCode){case 500:e="SERVER_ERROR",r="Error interno del servidor. Contacta al soporte t\xe9cnico.";break;case 503:e="SERVER_ERROR",r="Servicio temporalmente no disponible. Intenta m\xe1s tarde.";break;case 404:e="SERVER_ERROR",r="Servicio de autenticaci\xf3n no encontrado.";break;case 401:e="INVALID_CREDENTIALS",r="Credenciales inv\xe1lidas.";break;default:e="SERVER_ERROR",r="Error de servidor (".concat(n.statusCode,"). Intenta m\xe1s tarde.")}else(null==n?void 0:n.code)==="NETWORK_ERROR"?r="Error de conexi\xf3n. Verifica tu internet.":(null==n?void 0:n.code)==="TIMEOUT"&&(r="Tiempo de espera agotado. Intenta de nuevo.")}else t&&"object"==typeof t&&"graphQLErrors"in t&&t.graphQLErrors&&t.graphQLErrors.length>0&&(r="Error en la consulta GraphQL.");let n=new s.l(r,e,!0);return o(n.message),{error:n}}},loading:r,error:t||(null==n?void 0:n.message)||null}}(),{user:h,loading:p,fetchCurrentUser:R}=function(){let{data:e,loading:r,error:n,refetch:t}=(0,u.IT)(w,{skip:!(0,c.c4)(),errorPolicy:"all",notifyOnNetworkStatusChange:!0});return{user:null==e?void 0:e.me,loading:r,error:(null==n?void 0:n.message)||null,fetchCurrentUser:t}}(),{logout:v}=function(){let[e,{loading:r}]=(0,l.n)(E),[n,t]=(0,a.useState)(null);return{logout:async()=>{t(null);try{return await e(),(0,c.clearAuthTokens)(),!0}catch(e){return t(e instanceof Error?e.message:"Failed to logout"),(0,c.clearAuthTokens)(),!1}},loading:r,error:n}}(),{register:A,loading:P}=function(){let[e,{loading:r}]=(0,l.n)(_);return{register:async r=>{try{let{data:n}=await e({variables:r});if("AuthError"===n.register.__typename)throw new s.l(n.register.message||"Error al registrar usuario",n.register.code,!0);return(0,c.O5)(n.register.token),n.register.refreshToken&&(0,c.fE)(n.register.refreshToken),n.register}catch(e){if(e instanceof s.l)throw e;throw new s.l(e instanceof Error?e.message:"Error al registrar usuario","UNKNOWN_ERROR",!0)}},loading:r}}(),{requestPasswordReset:$,updatePassword:b}=function(){let[e,{loading:r}]=(0,l.n)(k),[n]=(0,l.n)(y);return{requestPasswordReset:async r=>{try{let{data:n}=await e({variables:{email:r}});if("ForgotPasswordError"===n.forgotPassword.__typename)throw new s.l(n.forgotPassword.message||"Error al solicitar recuperaci\xf3n",n.forgotPassword.code,!0);return n.forgotPassword}catch(e){if(e instanceof s.l)throw e;throw new s.l(e instanceof Error?e.message:"Error al solicitar recuperaci\xf3n","SERVER_ERROR",!0)}},updatePassword:async(e,r,t,o)=>{try{let{data:a}=await n({variables:{newPassword:e,code:r,email:t},context:{headers:{Authorization:"Bearer ".concat(o)}}});if("UpdatePasswordError"===a.updatePassword.__typename)throw new s.l(a.updatePassword.message||"Error al actualizar contrase\xf1a",a.updatePassword.code,!0);return a.updatePassword}catch(e){if(e instanceof s.l)throw e;throw new s.l(e instanceof Error?e.message:"Error al actualizar contrase\xf1a","SERVER_ERROR",!0)}},loading:r}}(),O=(0,a.useCallback)(async(e,r)=>{let n=await g(e,r);if("error"in n)throw n.error;return await R(),n.data},[g,R]),C=(0,a.useCallback)(async e=>{try{let r=await A(e);return await R(),r}catch(e){throw console.error("Auth context register error:",e),e}},[A,R]),N=(0,a.useCallback)(async()=>{let e=await v();return t(!1),e},[v]),T=(0,a.useCallback)(async e=>await $(e),[$]),x=(0,a.useCallback)(async(e,r,n,t)=>await b(e,r,n,t),[b]);return(0,a.useEffect)(()=>{(0,c.c4)()?R().then(e=>{t(!!e),d(!0)}).catch(()=>{t(!1),d(!0)}):(t(!1),d(!0))},[R]),(0,a.useEffect)(()=>{t(!!h)},[h]),(0,a.useEffect)(()=>{if(!n)return;let e=setInterval(async()=>{try{await R()}catch(e){console.error("Error refreshing token:",e),N()}},15e5);return()=>clearInterval(e)},[n,R,N]),(0,o.jsx)(S.Provider,{value:{user:h,isLoading:p||m||P,isAuthenticated:n,isInitialized:i,login:O,register:C,logout:N,resetPassword:T,updatePassword:x},children:r})}function A(){let e=(0,a.useContext)(S);if(void 0===e)throw Error("useAuthApollo debe ser utilizado dentro de un AuthProviderApollo");return e}}}]);