(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[371],{1183:(e,t,r)=>{"use strict";r.d(t,{default:()=>o});var s=r(5155);r(2115);var l=r(6874),n=r.n(l),a=r(2596);let o=e=>{let{children:t,variant:r="primary",href:l,onClick:o,className:i="",type:c="button",disabled:d=!1}=e,u=(0,a.A)("items-center justify-center px-8 py-3 text-base font-medium rounded-md inline-flex \n    transition-all duration-300 ease-in-out transform \n    hover:scale-105 hover:shadow-lg active:scale-95 active:opacity-80 \n    focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-emerald-500 \n    disabled:opacity-50 disabled:cursor-not-allowed \n    relative z-10 hover:cursor-pointer",{primary:"text-white bg-emerald-600 border border-transparent \n      hover:bg-emerald-700 hover:shadow-lg active:bg-emerald-500",secondary:"text-emerald-600 bg-white border border-emerald-600 \n      hover:bg-emerald-50 hover:shadow-sm active:bg-emerald-100"}[r],i,d&&"opacity-50 cursor-not-allowed");return l?(0,s.jsx)(n(),{href:l,className:u,children:t}):(0,s.jsx)("button",{type:c,className:u,onClick:o,disabled:d,children:t})}},1469:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),!function(e,t){for(var r in t)Object.defineProperty(e,r,{enumerable:!0,get:t[r]})}(t,{default:function(){return i},getImageProps:function(){return o}});let s=r(8229),l=r(8883),n=r(8301),a=s._(r(1193));function o(e){let{props:t}=(0,l.getImgProps)(e,{defaultLoader:a.default,imgConf:{deviceSizes:[640,750,828,1080,1200,1920,2048,3840],imageSizes:[16,32,48,64,96,128,256,384],path:"/_next/image",loader:"default",dangerouslyAllowSVG:!0,unoptimized:!1}});for(let[e,r]of Object.entries(t))void 0===r&&delete t[e];return{props:t}}let i=n.Image},2056:(e,t,r)=>{"use strict";r.d(t,{A:()=>l});var s=r(2115);let l=s.forwardRef(function(e,t){let{title:r,titleId:l,...n}=e;return s.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":l},n),r?s.createElement("title",{id:l},r):null,s.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.5 18.75h-9m9 0a3 3 0 0 1 3 3h-15a3 3 0 0 1 3-3m9 0v-3.375c0-.621-.503-1.125-1.125-1.125h-.871M7.5 18.75v-3.375c0-.621.504-1.125 1.125-1.125h.872m5.007 0H9.497m5.007 0a7.454 7.454 0 0 1-.982-3.172M9.497 14.25a7.454 7.454 0 0 0 .981-3.172M5.25 4.236c-.982.143-1.954.317-2.916.52A6.003 6.003 0 0 0 7.73 9.728M5.25 4.236V4.5c0 2.108.966 3.99 2.48 5.228M5.25 4.236V2.721C7.456 2.41 9.71 2.25 12 2.25c2.291 0 4.545.16 6.75.47v1.516M7.73 9.728a6.726 6.726 0 0 0 2.748 1.35m8.272-6.842V4.5c0 2.108-.966 3.99-2.48 5.228m2.48-5.492a46.32 46.32 0 0 1 2.916.52 6.003 6.003 0 0 1-5.395 4.972m0 0a6.726 6.726 0 0 1-2.749 1.35m0 0a6.772 6.772 0 0 1-3.044 0"}))})},2588:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>R});var s=r(5155),l=r(2115);function n(e){let{questionNumber:t,totalQuestions:r,question:n,options:a,onAnswerSelect:o}=e,[i,c]=(0,l.useState)(null),d=(e,t)=>{null===i&&(c(e),o(t))};return(0,s.jsxs)("div",{className:"bg-white rounded-xl shadow-lg mb-6 p-6 border-2 border-emerald-300",children:[(0,s.jsx)("div",{className:"justify-between mb-3 flex",children:(0,s.jsxs)("span",{className:"bg-emerald-600 text-white px-4 py-1 rounded-full text-sm font-semibold",children:["Pregunta ",t," de ",r]})}),(0,s.jsx)("p",{className:"text-xl md:text-2xl font-bold text-gray-800 mb-6",children:n}),(0,s.jsx)("div",{className:"md:grid-cols-2 grid grid-cols-1 gap-4",children:a.map(e=>(0,s.jsxs)("button",{type:"button",onClick:()=>d(e.letter,e.text),disabled:null!==i,className:"answer-option border-2 p-4 transition-all duration-200 transform\n              bg-white text-gray-700 rounded-lg text-left\n              ".concat(null===i?"hover:bg-emerald-50 border-emerald-300 hover:border-emerald-500 hover:-translate-y-1 hover:shadow-md":i===e.letter?"border-emerald-500 bg-emerald-50":"border-gray-200 opacity-50 cursor-not-allowed"),children:[(0,s.jsx)("span",{className:"w-8 h-8 rounded-full text-center font-bold leading-8 mr-2 inline-block\n                ".concat(i===e.letter?"bg-emerald-500 text-white":"bg-emerald-100 text-emerald-700"),children:e.letter}),(0,s.jsx)("span",{className:"font-medium",children:e.text})]},e.letter))})]})}function a(e){let{title:t,opponent:r,playerProgress:l,totalQuestions:n}=e;return(0,s.jsxs)("div",{className:"bg-emerald-100 rounded-lg mb-6 shadow-sm p-4",children:[(0,s.jsx)("div",{className:"justify-between items-center flex",children:(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-xl font-bold text-emerald-800",children:t}),(0,s.jsxs)("p",{className:"text-gray-600",children:["Vs. ",r]})]})}),(0,s.jsxs)("div",{className:"mt-4 items-center justify-between flex",children:[(0,s.jsxs)("div",{className:"items-center mr-4 flex space-x-2 flex-1",children:[(0,s.jsx)("div",{className:"h-3 bg-emerald-200 rounded-full flex-grow",children:(0,s.jsx)("div",{style:{width:"".concat(l/n*100,"%")},className:"h-3 bg-emerald-500 rounded-full"})}),(0,s.jsxs)("span",{className:"font-medium text-gray-700",children:[l,"/",n]})]}),(0,s.jsx)("div",{className:"items-center flex space-x-2 flex-1"})]})]})}let o=l.forwardRef(function(e,t){let{title:r,titleId:s,...n}=e;return l.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":s},n),r?l.createElement("title",{id:s},r):null,l.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M10.05 4.575a1.575 1.575 0 1 0-3.15 0v3m3.15-3v-1.5a1.575 1.575 0 0 1 3.15 0v1.5m-3.15 0 .075 5.925m3.075.75V4.575m0 0a1.575 1.575 0 0 1 3.15 0V15M6.9 7.575a1.575 1.575 0 1 0-3.15 0v8.175a6.75 6.75 0 0 0 6.75 6.75h2.018a5.25 5.25 0 0 0 3.712-1.538l1.732-1.732a5.25 5.25 0 0 0 1.538-3.712l.003-2.024a.668.668 0 0 1 .198-.471 1.575 1.575 0 1 0-2.228-2.228 3.818 3.818 0 0 0-1.12 2.687M6.9 7.575V12m6.27 4.318A4.49 4.49 0 0 1 16.35 15m.002 0h-.002"}))});var i=r(2056);let c=l.forwardRef(function(e,t){let{title:r,titleId:s,...n}=e;return l.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":s},n),r?l.createElement("title",{id:s},r):null,l.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m9.75 9.75 4.5 4.5m0-4.5-4.5 4.5M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"}))});function d(e){let{results:t,playerId:r,opponentId:l}=e,n=t.winner_id===r,a=r===t.player1_id;console.log("playerId",r),console.log("results.player1_id",t.player1_id),console.log("opponentId",l),console.log("isWinner",n),console.log("isPlayer1",a);let d=a?t.player1_score:t.player2_score,u=a?t.player2_score:t.player1_score,m=a?t.player1_elo:t.player2_elo,x=a?t.player2_elo:t.player1_elo,h=a?t.player1_rank:t.player2_rank,g=a?t.player2_rank:t.player1_rank;return(0,s.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:(0,s.jsxs)("div",{className:"max-w-2xl w-full bg-white rounded-xl shadow-lg p-8",children:[(0,s.jsxs)("div",{className:"text-center mb-8",children:[(0,s.jsx)("div",{className:"flex justify-center mb-4",children:t.is_draw?(0,s.jsx)(o,{className:"h-16 w-16 text-yellow-500"}):n?(0,s.jsx)(i.A,{className:"h-16 w-16 text-emerald-500"}):(0,s.jsx)(c,{className:"h-16 w-16 text-red-500"})}),(0,s.jsx)("h2",{className:"text-3xl font-bold text-gray-800 mb-2",children:t.is_draw?"\xa1Empate!":n?"\xa1Victoria!":"Derrota"}),(0,s.jsx)("p",{className:"text-gray-600",children:t.is_draw?"Ambos jugadores han empatado":n?"\xa1Has ganado el duelo!":"Tu oponente ha ganado el duelo"})]}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-8",children:[(0,s.jsxs)("div",{className:"bg-emerald-50 rounded-lg p-6",children:[(0,s.jsx)("h3",{className:"text-xl font-semibold text-emerald-800 mb-4",children:"Tus Resultados"}),(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsx)("span",{className:"text-gray-600",children:"Puntuaci\xf3n:"}),(0,s.jsxs)("span",{className:"font-semibold ".concat(d>=0?"text-emerald-600":"text-red-600"),children:[d>0?"+":"",d]})]}),(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsx)("span",{className:"text-gray-600",children:"Rango:"}),(0,s.jsx)("span",{className:"font-semibold text-emerald-800",children:h})]}),(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsx)("span",{className:"text-gray-600",children:"ELO:"}),(0,s.jsxs)("div",{className:"text-right",children:[(0,s.jsx)("span",{className:"font-semibold text-emerald-800",children:m.current}),(0,s.jsxs)("span",{className:"ml-2 ".concat(m.change>=0?"text-emerald-600":"text-red-600"),children:["(",m.change>0?"+":"",m.change,")"]})]})]})]})]}),(0,s.jsxs)("div",{className:"bg-gray-50 rounded-lg p-6",children:[(0,s.jsx)("h3",{className:"text-xl font-semibold text-gray-800 mb-4",children:"Resultados del Oponente"}),(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsx)("span",{className:"text-gray-600",children:"Puntuaci\xf3n:"}),(0,s.jsxs)("span",{className:"font-semibold ".concat(u>=0?"text-emerald-600":"text-red-600"),children:[u>0?"+":"",u]})]}),(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsx)("span",{className:"text-gray-600",children:"Rango:"}),(0,s.jsx)("span",{className:"font-semibold text-gray-800",children:g})]}),(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsx)("span",{className:"text-gray-600",children:"ELO:"}),(0,s.jsxs)("div",{className:"text-right",children:[(0,s.jsx)("span",{className:"font-semibold text-gray-800",children:x.current}),(0,s.jsxs)("span",{className:"ml-2 ".concat(x.change>=0?"text-emerald-600":"text-red-600"),children:["(",x.change>0?"+":"",x.change,")"]})]})]})]})]})]}),(0,s.jsx)("div",{className:"mt-8 text-center",children:(0,s.jsx)("button",{onClick:()=>window.location.reload(),className:"bg-emerald-600 hover:bg-emerald-700 text-white font-semibold py-3 px-6 rounded-lg transition-colors",children:"Volver a Jugar"})})]})})}function u(e){let{wsConnection:t,playerId:r,opponentId:o}=e,[i,c]=(0,l.useState)(null),[u,m]=(0,l.useState)(!0),[x,h]=(0,l.useState)(0),[g,p]=(0,l.useState)(0),[f]=(0,l.useState)(5),[b,v]=(0,l.useState)(null),[j,y]=(0,l.useState)(null);return((0,l.useEffect)(()=>{if(!t)return;let e=e=>{try{if(console.log("Raw WebSocket message:",e.data),console.log("Message type:",typeof e.data),"string"==typeof e.data&&!e.data.startsWith("{")){console.log("Received text message:",e.data),"\xa1Oponente conectado! El duelo comenzar\xe1 pronto."===e.data&&m(!0);return}let t="string"==typeof e.data?JSON.parse(e.data):e.data;console.log("Parsed WebSocket message:",t),"question"===t.type?(m(!1),c(t.data),v(null),p(e=>Math.min(e+1,f)-1)):"opponent_progress"===t.type?(console.log("Opponent progress update:",t.progress),p(t.progress),t.progress>=f&&v("Tu oponente ha terminado. Esperando tus respuestas...")):"duel_end"===t.type?(console.log("Duel end message received:",t),y(t.data),console.log("Duel results state set to:",t.data)):"error"===t.type?v(t.message):console.log("Unknown message type:",t.type)}catch(t){console.error("Error parsing WebSocket message:",t),console.error("Raw message that caused error:",e.data),v("Error al procesar el mensaje del servidor")}};return t.addEventListener("message",e),()=>{console.log("Cleaning up WebSocket connection"),t.removeEventListener("message",e)}},[t,f]),j)?(console.log("Rendering duel results:",j),(0,s.jsx)("div",{className:"min-h-screen",children:(0,s.jsx)(d,{results:j,playerId:r,opponentId:o})})):u?(0,s.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("div",{className:"animate-spin rounded-full h-16 w-16 border-t-2 border-b-2 border-emerald-500 mx-auto mb-4"}),(0,s.jsx)("h2",{className:"text-xl font-semibold text-gray-700",children:"Esperando al oponente..."}),(0,s.jsx)("p",{className:"text-gray-500 mt-2",children:"El duelo comenzar\xe1 cuando ambos jugadores est\xe9n listos"})]})}):i?(0,s.jsx)("div",{className:"min-h-screen flex flex-col",children:(0,s.jsx)("main",{className:"mx-auto px-4 py-6 flex-grow container",children:(0,s.jsxs)("div",{className:"mx-auto max-w-3xl",children:[b&&(0,s.jsx)("div",{className:"mb-4 p-4 bg-red-100 rounded-lg",children:(0,s.jsx)("p",{className:"text-red-700",children:b})}),(0,s.jsx)(a,{title:"Duelo de Preguntas",opponent:o,playerProgress:x,opponentProgress:g,totalQuestions:f}),(0,s.jsx)(n,{questionNumber:x+1,totalQuestions:f,question:i.text,options:i.options.map((e,t)=>({letter:String.fromCharCode(65+t),text:e})),onAnswerSelect:e=>{if(t&&i)try{t.send(JSON.stringify({type:"answer",questionId:i.id,answer:e})),h(e=>e+1),v(null)}catch(e){console.error("Error sending answer:",e),v("Error al enviar la respuesta")}}},i.id)]})})}):(0,s.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("h2",{className:"text-xl font-semibold text-gray-700",children:"Esperando la siguiente pregunta..."}),b&&(0,s.jsx)("p",{className:"text-red-500 mt-2",children:b})]})})}var m=r(6824),x=r(5933),h=r(6112),g=r(9249),p=r(5034),f=r(354),b=r(1929),v=r(8433),j=["refetch","reobserve","fetchMore","updateQuery","startPolling","stopPolling","subscribeToMore"],y=r(4998);function N(){let e=(0,x._)(["\n  query GetUserByEmail($email: String!) {\n    getUserByEmail(email: $email) {\n      id\n      username\n      email\n      fullName\n      avatar\n      role\n      createdAt\n      updatedAt\n    }\n  }\n"]);return N=function(){return e},e}function w(){let e=(0,x._)(["\n  mutation RequestDuel($input: RequestDuelInput!) {\n    requestDuel(input: $input) {\n      duelId\n      message\n    }\n  }\n"]);return w=function(){return e},e}function k(){let e=(0,x._)(["\n  mutation AcceptDuel($input: AcceptDuelInput!) {\n    acceptDuel(input: $input) {\n      duelId\n      message\n    }\n  }\n"]);return k=function(){return e},e}let E=(0,h.J1)(N()),S=(0,h.J1)(w()),I=(0,h.J1)(k());var D=r(1183),C=r(6766),_=r(5802);function W(){let{user:e}=(0,m.$)(),{searchUserByEmail:t,foundUser:r,searchLoading:n,searchError:a,requestDuel:o,requestLoading:c,requestError:d,acceptDuel:x,acceptLoading:h,acceptError:N,error:w}=function(){let{searchUserByEmail:e,loading:t,error:r,user:s}=function(){var e,t,r,s,l,n,a,o,i,c,d,u,m,x,h,y,N,w,k,S,I,D;let[C,{loading:_,error:W,data:R}]=(e={errorPolicy:"all",fetchPolicy:"cache-and-network"},r=p.useRef(void 0),s=p.useRef(void 0),l=p.useRef(void 0),a=null!=(t=null==(n=(0,f.l)(e,r.current||{}))?void 0:n.query)?t:E,s.current=e,l.current=a,o=(0,g.Cl)((0,g.Cl)({},n),{skip:!r.current}),c=(i=(0,b.SX)(a,o)).obsQueryFields,d=i.result,u=i.client,m=i.resultData,x=i.observable,h=i.onQueryExecuted,y=x.options.initialFetchPolicy||(0,b.kk)(o.defaultOptions,u.defaultOptions),N=p.useReducer(function(e){return e+1},0)[1],w=p.useMemo(function(){for(var e={},t=0;t<j.length;t++)!function(t){var s=c[t];e[t]=function(){return r.current||(r.current=Object.create(null),N()),s.apply(this,arguments)}}(j[t]);return e},[N,c]),k=!!r.current,S=p.useMemo(function(){return(0,g.Cl)((0,g.Cl)((0,g.Cl)({},d),w),{called:k})},[d,w,k]),I=p.useCallback(function(e){r.current=e?(0,g.Cl)((0,g.Cl)({},e),{fetchPolicy:e.fetchPolicy||y}):{fetchPolicy:y};var t,n,o,i,c,d,p,v,j,N=(0,f.l)(s.current,(0,g.Cl)({query:l.current},r.current)),k=(t=m,n=x,o=u,i=a,c=(0,g.Cl)((0,g.Cl)({},N),{skip:!1}),d=h,p=c.query||i,v=(0,b.Er)(o,p,c,!1)(n),j=n.reobserveAsConcast((0,b.t_)(n,o,c,v)),d(v),new Promise(function(e){var r;j.subscribe({next:function(e){r=e},error:function(){e((0,b.$X)(n.getCurrentResult(),t.previousData,n,o))},complete:function(){e((0,b.$X)(n.maskResult(r),t.previousData,n,o))}})})).then(function(e){return Object.assign(e,w)});return k.catch(function(){}),k},[u,a,w,y,x,m,h]),D=p.useRef(I),(0,v.E)(function(){D.current=I}),[p.useCallback(function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return D.current.apply(D,e)},[]),S]);return{searchUserByEmail:async e=>{try{let{data:t}=await C({variables:{email:e}});return(null==t?void 0:t.getUserByEmail)||null}catch(e){throw console.error("Error searching user by email:",e),e}},loading:_,error:(null==W?void 0:W.message)||null,user:(null==R?void 0:R.getUserByEmail)||null}}(),{requestDuel:l,loading:n,error:a}=function(){let[e,{loading:t,error:r}]=(0,y.n)(S,{errorPolicy:"all"});return{requestDuel:async(t,r)=>{try{let{data:s}=await e({variables:{input:{requesterId:t,opponentId:r}}});return s.requestDuel}catch(e){throw console.error("Error requesting duel:",e),e}},loading:t,error:(null==r?void 0:r.message)||null}}(),{acceptDuel:o,loading:i,error:c}=function(){let[e,{loading:t,error:r}]=(0,y.n)(I,{errorPolicy:"all"});return{acceptDuel:async t=>{try{let{data:r}=await e({variables:{input:{duelId:t}}});return r.acceptDuel}catch(e){throw console.error("Error accepting duel:",e),e}},loading:t,error:(null==r?void 0:r.message)||null}}();return{searchUserByEmail:e,foundUser:s,searchLoading:t,searchError:r,requestDuel:l,requestLoading:n,requestError:a,acceptDuel:o,acceptLoading:i,acceptError:c,isLoading:t||n||i,error:r||a||c}}(),[k,_]=(0,l.useState)(null),[W,R]=(0,l.useState)(null),[P,A]=(0,l.useState)(null),[M,q]=(0,l.useState)(null),[O,L]=(0,l.useState)(!1),[B,U]=(0,l.useState)({duelId:"",playerId:(null==e?void 0:e.id)||""}),[z,V]=(0,l.useState)(""),[$,J]=(0,l.useState)([]);(0,l.useEffect)(()=>{R(w||a||d||N)},[w,a,d,N]),(0,l.useEffect)(()=>{(null==e?void 0:e.id)?(console.log("User data loaded:",e),console.log("Setting playerId to:",e.id),U(t=>({...t,playerId:e.id}))):console.log("User data not available or missing ID:",e)},[e]),(0,l.useEffect)(()=>{let t=null,r=0,s=!0,l=setTimeout(()=>{s=!1},5e3);if((null==e?void 0:e.id)&&!M){console.log("Attempting to connect to notifications WebSocket for user ".concat(e.id,"..."));let n=()=>{r++;let l="ws://localhost:8002/ws/notifications/".concat(e.id);console.log("Connecting to WebSocket URL: ".concat(l," (attempt ").concat(r,")")),(t=new WebSocket(l)).onopen=()=>{console.log("Notification WebSocket connection established successfully"),R(null),r=0},t.onmessage=e=>{try{console.log("WebSocket message received:",e.data);let t=JSON.parse(e.data);"duel_request"===t.type?(console.log("Duel request notification received:",t),J(e=>[...e,{duelId:t.duelId,requesterId:t.requesterId,requesterName:t.requesterName,timestamp:new Date().toISOString()}])):"welcome"===t.type&&console.log("Welcome message received:",t)}catch(e){console.error("Error parsing WebSocket message:",e)}},t.onerror=e=>{!s&&r>2&&(R("Error de conexi\xf3n con el servidor. Reintentando..."),console.error("Notification WebSocket error:",e),console.log("WebSocket connection failed. Will retry in 3 seconds..."))},t.onclose=t=>{console.log("Notification WebSocket connection closed. Code: ".concat(t.code,", Reason: ").concat(t.reason)),1e3!==t.code&&setTimeout(()=>{console.log("Attempting to reconnect WebSocket..."),(null==e?void 0:e.id)&&n()},3e3)},q(t)};return n(),()=>{clearTimeout(l),console.log("Component unmounting, cleaning up WebSocket connection");try{null==t||t.close()}catch(e){console.error("Error closing WebSocket:",e)}}}},[e,M]),(0,l.useEffect)(()=>()=>{P&&P.close()},[P]);let T=async()=>{if(!z)return void R("Por favor, ingresa el correo del oponente");try{await t(z)?R(null):R("No se encontr\xf3 ning\xfan usuario con ese correo")}catch(e){R(e instanceof Error?e.message:"Error al buscar el usuario")}},F=async()=>{if(console.log("Current user state:",e),console.log("User ID:",null==e?void 0:e.id),e&&!e.id){console.log("User exists but ID is missing. Full user object:",JSON.stringify(e));let t=null;for(let r of["_id","userId","uid","userID"])if(e[r]){console.log("Found alternative ID field: ".concat(r," with value: ").concat(String(e[r]))),t=String(e[r]);break}if(t&&r){try{let e=await o(t,r.id);if(_(e),R(null),U(t=>({...t,duelId:e.duelId})),e.duelId){P&&P.close();let r=new WebSocket("ws://localhost:8002/ws/duels/".concat(e.duelId,"/").concat(t));r.onopen=()=>{R(null),L(!0)},r.onerror=e=>{R("Error en la conexi\xf3n WebSocket"),console.error("WebSocket error:",e)},r.onclose=()=>{W&&L(!1)},A(r)}}catch(e){R(e instanceof Error?e.message:"Error al solicitar el duelo"),_(null)}return}R("Tu sesi\xf3n existe pero falta el ID de usuario. Intenta cerrar sesi\xf3n y volver a iniciar.");return}if(!(null==e?void 0:e.id))return void R("Debes iniciar sesi\xf3n para solicitar un duelo");if(!r)return void R("Debes buscar y seleccionar un oponente primero");try{let t=String(e.id),s=await o(t,r.id);if(_(s),R(null),U(e=>({...e,duelId:s.duelId})),s.duelId&&(null==e?void 0:e.id)){P&&P.close();let t=new WebSocket("ws://localhost:8002/ws/duels/".concat(s.duelId,"/").concat(e.id));t.onopen=()=>{R(null),L(!0)},t.onerror=e=>{R("Error en la conexi\xf3n WebSocket"),console.error("WebSocket error:",e)},t.onclose=()=>{W&&L(!1)},A(t)}}catch(e){R(e instanceof Error?e.message:"Error al solicitar el duelo"),_(null)}},Q=e=>{X(e),J(t=>t.filter(t=>t.duelId!==e))},G=e=>{J(t=>t.filter(t=>t.duelId!==e))},X=async t=>{if(!t)return void R("Por favor, ingresa el ID del duelo");try{let r=await x(t);if(_(r),R(null),U(e=>({...e,duelId:t})),t&&(null==e?void 0:e.id)){P&&P.close();let r=new WebSocket("ws://localhost:8002/ws/duels/".concat(t,"/").concat(e.id));r.onopen=()=>{R(null),L(!0)},r.onerror=e=>{R("Error en la conexi\xf3n WebSocket"),console.error("WebSocket error:",e)},r.onclose=()=>{W&&L(!1)},A(r)}}catch(e){R(e instanceof Error?e.message:"Error al aceptar el duelo")}};return(0,s.jsx)("div",{className:"container mx-auto p-4",children:O?(0,s.jsx)(u,{wsConnection:P,playerId:B.playerId,opponentId:(null==r?void 0:r.id)||"user_002"}):(0,s.jsxs)("div",{className:"mx-auto px-4 py-8 container",children:[(0,s.jsxs)("p",{className:"text-3xl font-bold text-emerald-700 mb-6 text-center flex items-center justify-center gap-2",children:[(0,s.jsx)(i.A,{className:"w-8 h-8"}),"Duelos Acad\xe9micos"]}),(0,s.jsxs)("div",{className:"lg:flex-row flex flex-col gap-8",children:[(0,s.jsx)("div",{className:"lg:w-1/2 bg-gradient-to-br rounded-xl shadow-xl from-emerald-500 to-emerald-700 overflow-hidden",children:(0,s.jsxs)("div",{className:"flex flex-col",children:[(0,s.jsx)("div",{className:"items-center justify-center p-6 flex",children:(0,s.jsx)(C.default,{src:"/images/duels.webp",alt:"Duelo",width:300,height:400,className:"object-cover transform hover:scale-105 transition duration-300 rounded-lg h-64"})}),(0,s.jsxs)("div",{className:"text-white p-6",children:[(0,s.jsx)("p",{className:"text-2xl font-bold mb-4",children:"\xa1Desaf\xeda a tus compa\xf1eros!"}),(0,s.jsx)("p",{className:"mb-4",children:"Pon a prueba tus conocimientos y demuestra qui\xe9n es el mejor en tu clase. Gana monedas, experiencia y desbloquea logros especiales."}),(0,s.jsxs)("div",{className:"bg-white/20 rounded-lg mb-4 backdrop-blur-sm p-4",children:[(0,s.jsx)("p",{className:"font-bold text-xl mb-2",children:"Beneficios de los Duelos"}),(0,s.jsxs)("ul",{className:"list-disc list-inside space-y-1",children:[(0,s.jsx)("li",{children:"Gana hasta 50 monedas por victoria"}),(0,s.jsx)("li",{children:"Sube en el ranking de tu clase"}),(0,s.jsx)("li",{children:"Desbloquea insignias exclusivas"}),(0,s.jsx)("li",{children:"Refuerza tu aprendizaje mientras juegas"})]})]})]})]})}),(0,s.jsxs)("div",{className:"lg:w-1/2 bg-white rounded-xl shadow-lg border border-emerald-100 p-6 flex flex-col justify-center",children:[(0,s.jsxs)("div",{className:"items-center mb-6 flex",children:[(0,s.jsx)("div",{className:"bg-emerald-100 rounded-full mr-3 p-2",children:(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6 text-emerald-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M14 10l-2 1m0 0l-2-1m2 1v2.5M20 7l-2 1m2-1l-2-1m2 1v2.5M14 4l-2-1-2 1M4 7l2-1M4 7l2 1M4 7v2.5M12 21l-2-1m2 1l2-1m-2 1v-2.5M6 18l-2-1v-2.5M18 18l2-1v-2.5"})})}),(0,s.jsx)("p",{className:"text-2xl font-bold text-gray-800",children:"Desafiar a un Estudiante"})]}),(0,s.jsxs)("form",{className:"space-y-6",onSubmit:e=>{e.preventDefault(),T()},children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"opponentEmail",className:"text-sm font-medium text-gray-700 mb-1 block",children:"Correo del estudiante"}),(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)("div",{className:"pl-3 items-center absolute inset-y-0 left-0 flex pointer-events-none",children:(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M16 12a4 4 0 10-8 0 4 4 0 008 0zm0 0v1.5a2.5 2.5 0 005 0V12a9 9 0 10-9 9m4.5-1.206a8.959 8.959 0 01-4.5 1.207"})})}),(0,s.jsx)("input",{name:"opponentEmail",type:"email",value:z,onChange:e=>V(e.target.value),placeholder:"estudiante@universidad.edu",className:"border border-gray-300 focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 transition pl-10 w-full py-3 rounded-lg",id:"opponentEmail"})]})]}),(0,s.jsx)("div",{className:"pt-2",children:(0,s.jsx)(D.default,{type:"submit",disabled:n,className:"hover:bg-emerald-700 transition duration-300 hover:shadow-lg transform hover:-translate-y-1 w-full bg-emerald-600 text-white font-bold py-3 rounded-lg shadow-md",children:n?"Buscando...":"Buscar Estudiante"})})]}),r&&(0,s.jsxs)("div",{className:"mt-6 p-4 bg-emerald-50 rounded-lg",children:[(0,s.jsx)("h3",{className:"font-bold text-emerald-800 mb-2",children:"Oponente Encontrado:"}),(0,s.jsxs)("p",{className:"text-gray-700",children:["Nombre: ",r.fullName||r.username]}),(0,s.jsxs)("p",{className:"text-gray-700",children:["Correo: ",r.email]}),(0,s.jsxs)("p",{className:"text-gray-700",children:["Rol: ",r.role]}),(0,s.jsx)(D.default,{onClick:F,disabled:c,className:"mt-4 hover:bg-emerald-700 transition duration-300 hover:shadow-lg transform hover:-translate-y-1 w-full bg-emerald-600 text-white font-bold py-3 rounded-lg shadow-md",children:c?"Solicitando...":"Solicitar Duelo"})]}),k&&(0,s.jsxs)("div",{className:"mt-6 p-4 bg-emerald-50 rounded-lg",children:[(0,s.jsx)("h3",{className:"font-bold text-emerald-800 mb-2",children:"Duelo Solicitado:"}),(0,s.jsxs)("p",{className:"text-gray-700",children:["ID del Duelo: ",k.duelId]}),(0,s.jsxs)("p",{className:"text-gray-700",children:["Mensaje: ",k.message]})]}),$.length>0&&(0,s.jsxs)("div",{className:"mt-6 pt-4 border-t border-gray-200",children:[(0,s.jsx)("p",{className:"font-semibold text-gray-700 mb-2",children:"Desaf\xedos Pendientes"}),(0,s.jsx)("div",{className:"space-y-3",children:$.map(e=>(0,s.jsxs)("div",{className:"justify-between items-center bg-emerald-50 rounded-lg flex p-3",children:[(0,s.jsx)("div",{className:"items-center flex",children:(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"font-medium text-gray-800",children:"\xa1Desaf\xedo recibido!"}),(0,s.jsxs)("p",{className:"text-xs text-gray-500",children:["ID: ",e.duelId]}),(0,s.jsxs)("p",{className:"text-xs text-gray-500",children:["Recibido:"," ",new Date(e.timestamp).toLocaleString()]})]})}),(0,s.jsxs)("div",{className:"flex space-x-2",children:[(0,s.jsx)("button",{onClick:()=>Q(e.duelId),disabled:h,className:"hover:bg-emerald-600 bg-emerald-500 text-white px-3 py-1 rounded-md text-sm disabled:opacity-50",children:h?"Aceptando...":"Aceptar"}),(0,s.jsx)("button",{onClick:()=>G(e.duelId),className:"hover:bg-gray-300 bg-gray-200 text-gray-700 px-3 py-1 rounded-md text-sm",children:"Rechazar"})]})]},e.duelId))})]}),W&&(0,s.jsxs)("div",{className:"mt-6 p-4 bg-red-50 rounded-lg",children:[(0,s.jsx)("h3",{className:"font-bold text-red-700 mb-2",children:"Error:"}),(0,s.jsx)("p",{className:"text-red-600",children:W})]})]})]})]})})}function R(){return(0,s.jsx)(_.A,{children:(0,s.jsx)(W,{})})}},2596:(e,t,r)=>{"use strict";r.d(t,{A:()=>s});let s=function(){for(var e,t,r=0,s="",l=arguments.length;r<l;r++)(e=arguments[r])&&(t=function e(t){var r,s,l="";if("string"==typeof t||"number"==typeof t)l+=t;else if("object"==typeof t)if(Array.isArray(t)){var n=t.length;for(r=0;r<n;r++)t[r]&&(s=e(t[r]))&&(l&&(l+=" "),l+=s)}else for(s in t)t[s]&&(l&&(l+=" "),l+=s);return l}(e))&&(s&&(s+=" "),s+=t);return s}},4188:(e,t,r)=>{"use strict";r.d(t,{A:()=>l});var s=r(5155);r(2115);let l=()=>(0,s.jsx)("div",{className:"fixed inset-0 flex items-center justify-center bg-white backdrop-blur-sm z-50",children:(0,s.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-green-500"})})},5802:(e,t,r)=>{"use strict";r.d(t,{A:()=>i});var s=r(5155),l=r(2115),n=r(5695),a=r(6824),o=r(4188);function i(e){let{children:t,requiredRole:r}=e,i=(0,n.useRouter)(),{user:c,isLoading:d,isAuthenticated:u,isInitialized:m}=(0,a.$)();return((0,l.useEffect)(()=>{m&&(async()=>{if(console.log("\uD83D\uDD12 ProtectedRoute: Checking authentication with Apollo"),!u||!c){console.log("❌ ProtectedRoute: User not authenticated, redirecting to login");let e=window.location.pathname;i.push("/login?from=".concat(encodeURIComponent(e)));return}if(r&&c.role!==r){console.log("\uD83D\uDEAB ProtectedRoute: User role ".concat(c.role," doesn't match required role ").concat(r)),i.push("/dashboard");return}console.log("✅ ProtectedRoute: Authentication check passed")})()},[m,u,c,i,r]),!m||d)?(0,s.jsx)(o.A,{}):u&&c&&(!r||c.role===r)?(0,s.jsx)(s.Fragment,{children:t}):null}},6766:(e,t,r)=>{"use strict";r.d(t,{default:()=>l.a});var s=r(1469),l=r.n(s)},9499:(e,t,r)=>{Promise.resolve().then(r.bind(r,2588))}},e=>{var t=t=>e(e.s=t);e.O(0,[874,515,63,824,441,684,358],()=>t(9499)),_N_E=e.O()}]);